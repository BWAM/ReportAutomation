---
title: "Section 1 d)Observer Ranking of Recreational Ability"
author: "ALC"
date: "4/16/2020"
output: html_document
---

```{r}
library(tidyverse)
library(ggthemes)
library(flextable)
```


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#set up the file path
file.path=file.path(here::here(),
          "data",
          "userp_wallkill.csv")

```

```{r include=FALSE,message=FALSE,warning=FALSE}
#read in the data
UserP_all<-read.csv(file.path,stringsAsFactors = FALSE)
```

```{r include=FALSE,message=FALSE,warning=FALSE}
#function to create mean primary and secondary rankings graph
#first convert letters to scores and move data to long format
userp_contact_fig<-function(df, bar.width, ...){
contact<-UserP_all%>%
  mutate(Primary=ifelse(UPFDH_PRIMARY_CONTACT=="A", yes=1, no=ifelse(UPFDH_PRIMARY_CONTACT=="B", yes=2, no=ifelse(UPFDH_PRIMARY_CONTACT=="C", yes=3, no=ifelse(UPFDH_PRIMARY_CONTACT=="D", yes=4, no=ifelse(UPFDH_PRIMARY_CONTACT=="E", yes=5, no=ifelse(UPFDH_PRIMARY_CONTACT=="F", yes=6, no=NA)))))),
         Secondary=ifelse(UPFDH_SECONDARY_CONTACT=="A", yes=1, no=ifelse(UPFDH_SECONDARY_CONTACT=="B", yes=2, no=ifelse(UPFDH_SECONDARY_CONTACT=="C", yes=3, no=ifelse(UPFDH_SECONDARY_CONTACT=="D", yes=4, no=ifelse(UPFDH_SECONDARY_CONTACT=="E", yes=5, no=ifelse(UPFDH_SECONDARY_CONTACT=="F", yes=6, no=NA)))))))%>%
  select(SITE_ID, Primary, Secondary)%>%
  pivot_longer(-SITE_ID, names_to = "Contact Type", values_to = "value")

#second build plot
plot<-ggplot(contact, aes(x=SITE_ID, y=value, fill=`Contact Type`))+
  geom_bar(position="dodge", width=bar.width, na.rm = TRUE, stat = "summary", fun.y = "mean")+
  ylab("Mean Observer Ranking")+
  xlab("Location ID")+
  ylim(0,6)+
  scale_fill_grey()+
  theme_pander() +
      theme(axis.text.x = element_text(angle = 60, hjust = 1))+
      theme(legend.position="right")

print(plot)
}
```

```{r fig.height=5,fig.width=7.5,message=FALSE,warning=FALSE}
userp_contact_fig(UserP_all, bar.width = 0.7)
```

```{r include=FALSE,message=FALSE,warning=FALSE}
#create table of mean scores for Variables influencing recreation
userp_variable_table<-function(df){
Variables<-df%>%
  group_by(SITE_ID)%>%
  summarize(`Water Clarity`=round(mean(UPFDH_WATER_CLARITY, na.rm = TRUE), digits=0),
            `Suspended Phytoplankton`= round(mean(UPFDH_SUSP_PHYTOPLANKTON, na.rm = TRUE),digits=0),
            Periphyton= round(mean(UPFDH_PERIPHYTON, na.rm = TRUE), digits=0),
            Macrophyte= round(mean(UPFDH_MACROPHYTE, na.rm = TRUE), digits=0),
            Odor=round(mean(UPFDH_ODOR, na.rm=TRUE), digits=0),
            Trash= round(mean(UPFDH_TRASH, na.rm = TRUE), digits=0),
            `Discharge Pipes`= round(mean(UPFDH_DISCHARGE_PIPE, na.rm = TRUE), digits=0))

final_table<-flextable(Variables)%>%
  theme_zebra()%>%
  set_header_labels(SITE_ID="Location \n ID", `Water Clarity`="Water \n Clarity", `Suspended Phytoplankton`="Suspended \nPhytoplankton", Periphyton="Periphyton", Odor="Odor", Trash="Trash", `Discharge Pipes`= "Dishcarge \n Pipes")%>%
  align(j=2:8, align="center", part="all")%>%
  width(j = c(2,4:5,8), width = 1)%>%
  width(j = 3, width = 1.2)%>%
  width(j=1, width=1.2)
final_table
}  
```

```{r}
userp_variable_table(UserP_all)
```

```{r}
# function for graph of Dominant Factor influencing recreation

Dominant<-UserP_all%>%
  mutate(Primary=ifelse(UPFDH_PRIMARY_VARIABLE=="Water Clarity", yes=1, no=ifelse(UPFDH_PRIMARY_VARIABLE=="Trash", yes=2, no=ifelse(UPFDH_PRIMARY_VARIABLE=="Periphyton", yes=4, no=ifelse(UPFDH_PRIMARY_VARIABLE=="Odor", yes=6, no=ifelse(UPFDH_PRIMARY_VARIABLE=="Discharge/Pipes", yes=7, no=ifelse(UPFDH_PRIMARY_VARIABLE=="Proximity_to_Development_Roads", yes=5, no=ifelse(UPFDH_PRIMARY_VARIABLE=="Other", yes=9, no=ifelse(UPFDH_PRIMARY_VARIABLE=="None", yes=0, no=ifelse(UPFDH_PRIMARY_VARIABLE=="Macrophyte", yes=3, no=ifelse(UPFDH_PRIMARY_VARIABLE=="Suspended_Phytoplankton", yes=8, no= NA)))))))))),
         Secondary=ifelse(UPFDH_SECONDARY_VARIABLE=="Water clarity", yes=1, no=ifelse(UPFDH_SECONDARY_VARIABLE=="Trash", yes=2, no=ifelse(UPFDH_SECONDARY_VARIABLE=="Periphyton", yes=4, no=ifelse(UPFDH_SECONDARY_VARIABLE=="Odor", yes=6, no=ifelse(UPFDH_SECONDARY_VARIABLE=="Discharge/Pipes", yes=7, no=ifelse(UPFDH_SECONDARY_VARIABLE=="Proximity to development roads", yes=5, no=ifelse(UPFDH_SECONDARY_VARIABLE=="Other", yes=8, no=ifelse(UPFDH_SECONDARY_VARIABLE=="None", yes=0, no=ifelse(UPFDH_SECONDARY_VARIABLE=="Macrophyte", yes=3, no= NA))))))))))%>%
  select(SITE_ID, Primary, Secondary)%>%
  pivot_longer(-SITE_ID, names_to = "Contact Type", values_to = "value")
```

None, Macrophyte