---
title: "section1E_toxicity"
author: 'NYSDEC SMAS : Keleigh Reynolds'
date: "4/17/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(dplyr)

#for the table
file.path.tw<-file.path(here::here(),
                       "data",
                       "tox_water_results.csv")

file.path.ts<-file.path(here::here(),
                       "data",
                       "tox_sediment_results.csv")
file.path.s<-file.path(here::here(),
                       "data",
                       "sites_wallkill.csv")


#read in the data to concatenate
tox_s<-read.csv(file.path.ts,stringsAsFactors = FALSE)
tox_w<-read.csv(file.path.tw,stringsAsFactors = FALSE)
sites<-read.csv(file.path.s,stringsAsFactors = FALSE)

```

```{r message=FALSE,warning=FALSE}
#create function for common tables
#df is the data frame, x and y are the column numbers you want centered, z is the caption
table.f<-function(df,x,y){
 library(flextable)
  tl<-flextable(df) %>% font(i = NULL, j = NULL, fontname="Arial", part = "all") %>% theme_zebra() %>% autofit()
tl<-align(tl, i = NULL, j =(x:y) , align = "center", part = "all")
tl
}

```

```{r}
#select and shorten the files
#merge the other 2
tox.df<-merge(tox_s,tox_w,all = TRUE)

tox.df<-tox.df %>% 
  select(station,stationID,Sediment.Collection.Test.Date,Water.Collection.Test.Start.Date,Sediment.Assessment,
         Porewater.Assessment,Sediment.EC50....,Porewater.EC50....)

#take out just the Wallkill ones
sites.ls<-unique(sites$SH_SITE_ID)

tox.df<-tox.df %>% 
  filter(stationID %in% sites.ls)

tox.tbl<-tox.df %>% 
  rename("Station"=station,
         "Station ID"=stationID,
    "Sample Date"=Sediment.Collection.Test.Date,
         "Test Date"=Water.Collection.Test.Start.Date,
         "Sediment Assessment"=Sediment.Assessment,
         "Porewater Assessment"=Porewater.Assessment,
         "Sediment EC50"=Sediment.EC50....,
         "Porewater EC50"=Porewater.EC50....)
#taking out the other test date column, since they are blank.
tox.tbl$`Test Date`<-NULL

```

### E)	Sediment and Porewater Microtox® Analysis

Toxicity testing of surface waters, sediments, porewaters, and effluents are routinely performed as part of the RIBS program (https://www.dec.ny.gov/chemical/29854.html). Sediment toxicity was evaluated according to SOP #403-16 Microtox® Acute Toxicity Test for Sediments, Porewaters and Effluents. Testing procedures use a bioassay to assess potential acute toxicity in sediments and surface waters to aquatic life (SOP #403-16). Sediment and extracted sediment porewater samples are tested using a bioluminescent bacterium Vibrio fischeri (V. fischeri). Tests are a measure of light reduction between collected samples and a control following a 15-minute exposure period and expressed as the median effect concentration (EC50) of a sample that causes a 50% reduction in light emission from the V. fischeri. Appendix X (Fact Sheet: Acute & Chronic Toxicity Assessments of NY Streams & Rivers) describes toxicity testing procedures, Assessment criteria and results classifications. 


```{r}
#call table function
table.f(tox.tbl,2,7)
```



