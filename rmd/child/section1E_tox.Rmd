---
title: "section1E_toxicity"
author: 'NYSDEC SMAS : Keleigh Reynolds'
date: "4/17/2020"
<<<<<<< HEAD
output:
  word_document: default
  html_document: default
---

```{r setup, include=FALSE,message=FALSE,warning=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
=======
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(dplyr)
>>>>>>> 21cb47628fcc1b6467dd7d8e698ebb0a33181222

#for the table
file.path.tw<-file.path(here::here(),
                       "data",
                       "tox_water_results.csv")

file.path.ts<-file.path(here::here(),
                       "data",
                       "tox_sediment_results.csv")
file.path.s<-file.path(here::here(),
                       "data",
                       "sites_wallkill.csv")


#read in the data to concatenate
tox_s<-read.csv(file.path.ts,stringsAsFactors = FALSE)
tox_w<-read.csv(file.path.tw,stringsAsFactors = FALSE)
sites<-read.csv(file.path.s,stringsAsFactors = FALSE)

```

<<<<<<< HEAD

```{r include=FALSE,message=FALSE,warning=FALSE}
=======
```{r message=FALSE,warning=FALSE}
>>>>>>> 21cb47628fcc1b6467dd7d8e698ebb0a33181222
#create function for common tables
#df is the data frame, x and y are the column numbers you want centered, z is the caption
table.f<-function(df,x,y){
 library(flextable)
  tl<-flextable(df) %>% font(i = NULL, j = NULL, fontname="Arial", part = "all") %>% theme_zebra() %>% autofit()
tl<-align(tl, i = NULL, j =(x:y) , align = "center", part = "all")
tl
}

```

<<<<<<< HEAD
```{r include=FALSE,message=FALSE,warning=FALSE}
#function to make the sites a factor in order from upstream to downstream
order_sites<-function(df, sites_table, df_site_col, sites_site_col){
Sites<-sites_table%>%
  rename(SITE_ID=sites_site_col)

df<-df%>%
  rename(SITE_ID=df_site_col)

all_data<-left_join(df, Sites, by="SITE_ID")
all_data<-all_data%>%
  arrange(order)%>%
  mutate(SITE_ID=factor(SITE_ID, levels = unique(SITE_ID)))%>%
  select(-c(order:UPDATED_BY_GUID))
}
```

```{r include=FALSE,message=FALSE,warning=FALSE}
=======
```{r}
>>>>>>> 21cb47628fcc1b6467dd7d8e698ebb0a33181222
#select and shorten the files
#merge the other 2
tox.df<-merge(tox_s,tox_w,all = TRUE)

tox.df<-tox.df %>% 
  select(station,stationID,Sediment.Collection.Test.Date,Water.Collection.Test.Start.Date,Sediment.Assessment,
         Porewater.Assessment,Sediment.EC50....,Porewater.EC50....)

#take out just the Wallkill ones
sites.ls<-unique(sites$SH_SITE_ID)

tox.df<-tox.df %>% 
<<<<<<< HEAD
  filter(stationID %in% sites.ls)%>%
  separate(Sediment.Collection.Test.Date, into=c("Collection_Date", "Test_Date"), sep="/")%>%
  mutate(Test_Date=gsub(pattern="\\s&\\s\\d\\d" , replacement="", x=Test_Date))%>%
  select(-Water.Collection.Test.Start.Date, -station)%>%
   order_sites(sites_table = sites, df_site_col = "stationID", sites_site_col = "SH_SITE_ID")

tox.tbl<-tox.df %>% 
  rename("Station ID"=SITE_ID,
    "Sample Date"=Collection_Date,
         "Test Date"=Test_Date,
         "Sediment \n Assessment"=Sediment.Assessment,
         "Porewater \n Assessment"=Porewater.Assessment,
         "Sediment \n EC50"=Sediment.EC50....,
         "Porewater \n EC50"=Porewater.EC50....)
 
=======
  filter(stationID %in% sites.ls)

tox.tbl<-tox.df %>% 
  rename("Station"=station,
         "Station ID"=stationID,
    "Sample Date"=Sediment.Collection.Test.Date,
         "Test Date"=Water.Collection.Test.Start.Date,
         "Sediment Assessment"=Sediment.Assessment,
         "Porewater Assessment"=Porewater.Assessment,
         "Sediment EC50"=Sediment.EC50....,
         "Porewater EC50"=Porewater.EC50....)
#taking out the other test date column, since they are blank.
tox.tbl$`Test Date`<-NULL

>>>>>>> 21cb47628fcc1b6467dd7d8e698ebb0a33181222
```

### E)	Sediment and Porewater Microtox® Analysis

Toxicity testing of surface waters, sediments, porewaters, and effluents are routinely performed as part of the RIBS program (https://www.dec.ny.gov/chemical/29854.html). Sediment toxicity was evaluated according to SOP #403-16 Microtox® Acute Toxicity Test for Sediments, Porewaters and Effluents. Testing procedures use a bioassay to assess potential acute toxicity in sediments and surface waters to aquatic life (SOP #403-16). Sediment and extracted sediment porewater samples are tested using a bioluminescent bacterium Vibrio fischeri (V. fischeri). Tests are a measure of light reduction between collected samples and a control following a 15-minute exposure period and expressed as the median effect concentration (EC50) of a sample that causes a 50% reduction in light emission from the V. fischeri. Appendix X (Fact Sheet: Acute & Chronic Toxicity Assessments of NY Streams & Rivers) describes toxicity testing procedures, Assessment criteria and results classifications. 


<<<<<<< HEAD
```{r echo=FALSE, message=FALSE,warning=FALSE}
#call table function
table.f(tox.tbl,2,7)%>%
  fontsize(size = 10, part = "all")%>%
  width(j=4:7, width=1.2)
=======
```{r}
#call table function
table.f(tox.tbl,2,7)
>>>>>>> 21cb47628fcc1b6467dd7d8e698ebb0a33181222
```



